



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>connectomics.training.lit.data &mdash; connectomics latest documentation</title>
  

  
  
  
  

  

  
  
  

  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../../_static/css/pytc-theme.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/readthedocs-doc-embed.css" type="text/css" />
  <link rel="index" title="Index" href="../../../../genindex.html" />
  <link rel="search" title="Search" href="../../../../search.html" /> 

    <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="text.css" type="text/css" />

  <!-- at the end of the HEAD -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">

    <a class="header-logo" href="../../../../index.html" aria-label="PyTC"></a>

    <div class="header-container">

      <div class="main-menu">
        <ul>
          <li>
            <a href="../../../../notes/installation.html">Get Started</a>
          </li>
          <li>
            <a href="../../../../tutorials/neuron.html">Tutorials</a>
          </li>
          <li>
            <a href="../../../../index.html">Docs</a>
          </li>
          <li>
            <a href="https://github.com/zudi-lin/pytorch_connectomics/tree/master">GitHub</a>
          </li>
          <li>
            <a href="../../../../about/team.html">About Us</a>
          </li>

        </ul>
      </div>

      <!-- <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a> -->
    </div>

  </div>
</div>


<body class="pytorch-body">

   

  

  <div class="table-of-contents-link-wrapper">
    <span>Table of Contents</span>
    <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
  </div>

  <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
    <div class="pytorch-side-scroll">
      <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <div class="pytorch-left-menu-search">
          

          
          
          
          <div class="version">
            latest
          </div>
          
          

          <div id="docsearch"></div>

          
        </div>

        
        
        
        
        
        
        <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/config.html">Configuration System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/dataloading.html">Data Loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/migration.html">Migration Guide (v1.0 â†’ v2.0)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/neuron.html">Neuron Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/mito.html">Mitochondria Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/synapse.html">Synapse Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/artifact.html">Artifacts Detection (Draft)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../external/neuroglancer.html">Neuroglancer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/lightning.html">Lightning Module API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/model.html">connectomics.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/data.html">connectomics.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/utils.html">connectomics.utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../about/team.html">About Us</a></li>
</ul>

        
        
      </div>
    </div>

    


    

    <!-- 
    
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
      <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Read the Docs</span>
        v: latest
        <span class="fa fa-caret-down"></span>
      </span>
      <div class="rst-other-versions">
        <dl>
          <dt>Versions</dt>
          
          <dd><a href="#">latest</a></dd>
          
        </dl>
        <dl>
          <dt>Downloads</dt>
          <dd><a href="https://github.com/zudi-lin/pytorch_connectomics/">PDF</a>
          </dd>
          <dd><a href="https://github.com/zudi-lin/pytorch_connectomics/">HTML</a></dd>
        </dl>
        <dl>
          <dt>On Github</dt>
          <dd><a href="https://github.com/zudi-lin/pytorch_connectomics">Home</a></dd>
          <dd><a href="https://github.com/zudi-lin/pytorch_connectomics/">Docs</a></dd>
        </dl>
      </div>
    </div>
    
     -->

  </nav>


  <div class="pytorch-container">
    <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
      <div class="pytorch-breadcrumbs-wrapper">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../../index.html">Module code</a> &gt;</li>
        
      <li>connectomics.training.lit.data</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
      </div>

      <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
        Shortcuts
      </div>
    </div>

    <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
      <div class="pytorch-content-left">

        
        
          <div class="rst-content">
            
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
              <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
                
  <h1>Source code for connectomics.training.lit.data</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">PyTorch Lightning DataModules for MONAI-native connectomics datasets.</span>

<span class="sd">This module provides Lightning DataModule wrappers around the MONAI connectomics</span>
<span class="sd">datasets, enabling seamless integration with PyTorch Lightning training workflows.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytorch_lightning</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monai.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">Compose</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">connectomics.data.dataset</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">MonaiConnectomicsDataset</span><span class="p">,</span>
    <span class="n">MonaiCachedConnectomicsDataset</span><span class="p">,</span>
    <span class="n">MonaiPersistentConnectomicsDataset</span><span class="p">,</span>
    <span class="n">MonaiVolumeDataset</span><span class="p">,</span>
    <span class="n">MonaiCachedVolumeDataset</span><span class="p">,</span>
    <span class="n">MonaiTileDataset</span><span class="p">,</span>
    <span class="n">MonaiCachedTileDataset</span><span class="p">,</span>
    <span class="n">create_connectomics_dataset</span><span class="p">,</span>
    <span class="n">create_data_dicts_from_paths</span><span class="p">,</span>
    <span class="n">create_volume_dataset</span><span class="p">,</span>
    <span class="n">create_tile_dataset</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">connectomics.data.process</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_label_transform_pipeline</span>


<div class="viewcode-block" id="ConnectomicsDataModule">
<a class="viewcode-back" href="../../../../modules/lightning.html#connectomics.training.lit.ConnectomicsDataModule">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ConnectomicsDataModule</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningDataModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base Lightning DataModule for MONAI connectomics datasets.</span>

<span class="sd">    This DataModule provides a unified interface for different types of connectomics</span>
<span class="sd">    datasets (volume, tile, cloud) with automatic train/val/test splits and</span>
<span class="sd">    MONAI transform pipelines.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_data_dicts (List[Dict]): Training data dictionaries</span>
<span class="sd">        val_data_dicts (List[Dict], optional): Validation data dictionaries</span>
<span class="sd">        test_data_dicts (List[Dict], optional): Test data dictionaries</span>
<span class="sd">        transforms (Dict[str, Compose], optional): Transform pipelines for each split</span>
<span class="sd">        dataset_type (str): Type of dataset (&#39;standard&#39;, &#39;cached&#39;, &#39;persistent&#39;)</span>
<span class="sd">        batch_size (int): Batch size for data loaders. Default: 1</span>
<span class="sd">        num_workers (int): Number of workers for data loading. Default: 0</span>
<span class="sd">        pin_memory (bool): Whether to use pinned memory. Default: True</span>
<span class="sd">        persistent_workers (bool): Whether to use persistent workers. Default: False</span>
<span class="sd">        cache_rate (float): Cache rate for cached datasets. Default: 1.0</span>
<span class="sd">        cache_dir (str): Cache directory for persistent datasets. Default: &#39;./cache&#39;</span>
<span class="sd">        **dataset_kwargs: Additional arguments for dataset initialization</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">train_data_dicts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">val_data_dicts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_data_dicts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Compose</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pin_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">persistent_workers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">cache_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">cache_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./cache&quot;</span><span class="p">,</span>
        <span class="n">train_transpose_axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_transpose_axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_transpose_axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_iter_num</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">dataset_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Store data dictionaries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data_dicts</span> <span class="o">=</span> <span class="n">train_data_dicts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_data_dicts</span> <span class="o">=</span> <span class="n">val_data_dicts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data_dicts</span> <span class="o">=</span> <span class="n">test_data_dicts</span>

        <span class="n">val_has_entries</span> <span class="o">=</span> <span class="n">val_data_dicts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_data_dicts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_validation</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">val_has_entries</span>

        <span class="c1"># Store transforms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Store dataset and dataloader configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span> <span class="o">=</span> <span class="n">dataset_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">=</span> <span class="n">num_workers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span> <span class="o">=</span> <span class="n">pin_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">persistent_workers</span> <span class="o">=</span> <span class="n">persistent_workers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_rate</span> <span class="o">=</span> <span class="n">cache_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">cache_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_iter_num</span> <span class="o">=</span> <span class="n">val_iter_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>  <span class="c1"># [FIX 1] Store seed for validation reseeding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_kwargs</span> <span class="o">=</span> <span class="n">dataset_kwargs</span>

        <span class="c1"># Store mode-specific transpose axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_transpose_axes</span> <span class="o">=</span> <span class="n">train_transpose_axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_transpose_axes</span> <span class="o">=</span> <span class="n">val_transpose_axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_transpose_axes</span> <span class="o">=</span> <span class="n">test_transpose_axes</span>

        <span class="c1"># Datasets will be created in setup()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_dataset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="ConnectomicsDataModule.setup">
<a class="viewcode-back" href="../../../../modules/lightning.html#connectomics.training.lit.ConnectomicsDataModule.setup">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup datasets for the specified stage.&quot;&quot;&quot;</span>

        <span class="n">val_has_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_data_dicts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_data_dicts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_validation</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">val_has_entries</span>

        <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="s2">&quot;fit&quot;</span> <span class="ow">or</span> <span class="n">stage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Setup training dataset</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data_dicts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset</span><span class="p">(</span>
                    <span class="n">data_dicts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data_dicts</span><span class="p">,</span>
                    <span class="n">transforms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">),</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Setup validation dataset</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_data_dicts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">val_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset</span><span class="p">(</span>
                    <span class="n">data_dicts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">val_data_dicts</span><span class="p">,</span>
                    <span class="n">transforms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">),</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span> <span class="ow">or</span> <span class="n">stage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Setup test dataset</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data_dicts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset</span><span class="p">(</span>
                    <span class="n">data_dicts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data_dicts</span><span class="p">,</span>
                    <span class="n">transforms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">),</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
                <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data_dicts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Compose</span><span class="p">],</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">MonaiConnectomicsDataset</span><span class="p">,</span> <span class="n">MonaiCachedConnectomicsDataset</span><span class="p">,</span> <span class="n">MonaiPersistentConnectomicsDataset</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create appropriate dataset based on configuration.&quot;&quot;&quot;</span>

        <span class="c1"># Prepare dataset arguments</span>
        <span class="n">dataset_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data_dicts&quot;</span><span class="p">:</span> <span class="n">data_dicts</span><span class="p">,</span>
            <span class="s2">&quot;transforms&quot;</span><span class="p">:</span> <span class="n">transforms</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_kwargs</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Use separate iter_num for validation if specified</span>
        <span class="c1"># This MUST come after unpacking dataset_kwargs to override the training iter_num</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_iter_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dataset_args</span><span class="p">[</span><span class="s2">&quot;iter_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_iter_num</span>

        <span class="c1"># Note: transpose_axes should be embedded in the transforms (via LoadVolumed)</span>
        <span class="c1"># and NOT passed as a dataset parameter. The transform builders handle this.</span>

        <span class="c1"># Add type-specific arguments</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span> <span class="o">==</span> <span class="s2">&quot;cached&quot;</span><span class="p">:</span>
            <span class="n">dataset_args</span><span class="p">[</span><span class="s2">&quot;cache_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_rate</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span> <span class="o">==</span> <span class="s2">&quot;persistent&quot;</span><span class="p">:</span>
            <span class="n">dataset_args</span><span class="p">[</span><span class="s2">&quot;cache_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span>

        <span class="k">return</span> <span class="n">create_connectomics_dataset</span><span class="p">(</span>
            <span class="n">dataset_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span>
            <span class="o">**</span><span class="n">dataset_args</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ConnectomicsDataModule.train_dataloader">
<a class="viewcode-back" href="../../../../modules/lightning.html#connectomics.training.lit.ConnectomicsDataModule.train_dataloader">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">train_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataLoader</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create training data loader.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConnectomicsDataModule.val_dataloader">
<a class="viewcode-back" href="../../../../modules/lightning.html#connectomics.training.lit.ConnectomicsDataModule.val_dataloader">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">val_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataLoader</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">DataLoader</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create validation data loader.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_validation</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># NOTE: Validation reseeding is now handled by ValidationReseedingCallback</span>
        <span class="c1"># in on_validation_epoch_start() which runs EVERY validation epoch.</span>
        <span class="c1"># DO NOT reseed here - val_dataloader() is only called ONCE during trainer.fit() setup!</span>

        <span class="n">dataloader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_dataset</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># If validation dataset exists but dataloader creation failed,</span>
        <span class="c1"># skip validation rather than using dummy data</span>
        <span class="k">if</span> <span class="n">dataloader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Validation dataloader creation failed despite validation dataset being provided. &quot;</span>
                <span class="s2">&quot;Skipping validation. Check your data configuration.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">dataloader</span></div>


<div class="viewcode-block" id="ConnectomicsDataModule.test_dataloader">
<a class="viewcode-back" href="../../../../modules/lightning.html#connectomics.training.lit.ConnectomicsDataModule.test_dataloader">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataLoader</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create test data loader.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConnectomicsDataModule.predict_dataloader">
<a class="viewcode-back" href="../../../../modules/lightning.html#connectomics.training.lit.ConnectomicsDataModule.predict_dataloader">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataLoader</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create predict data loader (same as test dataloader).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dataloader</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dataloader</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span>
        <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataLoader</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create data loader for the given dataset.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>
            <span class="n">pin_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span><span class="p">,</span>
            <span class="n">persistent_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persistent_workers</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">collate_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_collate_fn</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_collate_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom collate function for MONAI data.&quot;&quot;&quot;</span>
        <span class="c1"># Stack samples while preserving dict structure</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">batch</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Get all keys from first sample</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="c1"># Stack all values for this key</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
            <span class="c1"># Convert to tensor if not already</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>  <span class="c1"># Keep as list if not tensor/array</span>

        <span class="k">return</span> <span class="n">result</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">VolumeDataModule</span><span class="p">(</span><span class="n">ConnectomicsDataModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lightning DataModule specifically for volume-based connectomics datasets.</span>

<span class="sd">    This DataModule provides volume-specific functionality with optimized</span>
<span class="sd">    data loading for volumetric connectomics data.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_image_paths (List[str]): Training image file paths</span>
<span class="sd">        train_label_paths (List[str], optional): Training label file paths</span>
<span class="sd">        train_mask_paths (List[str], optional): Training mask file paths</span>
<span class="sd">        val_image_paths (List[str], optional): Validation image file paths</span>
<span class="sd">        val_label_paths (List[str], optional): Validation label file paths</span>
<span class="sd">        val_mask_paths (List[str], optional): Validation mask file paths</span>
<span class="sd">        test_image_paths (List[str], optional): Test image file paths</span>
<span class="sd">        test_label_paths (List[str], optional): Test label file paths</span>
<span class="sd">        test_mask_paths (List[str], optional): Test mask file paths</span>
<span class="sd">        sample_size (Tuple[int, int, int]): Size of samples to extract (z, y, x)</span>
<span class="sd">        **kwargs: Additional arguments passed to ConnectomicsDataModule</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">train_image_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">train_label_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">train_mask_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_image_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_label_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_mask_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_image_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_label_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_mask_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sample_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Create data dictionaries from paths</span>
        <span class="n">train_data_dicts</span> <span class="o">=</span> <span class="n">create_data_dicts_from_paths</span><span class="p">(</span>
            <span class="n">image_paths</span><span class="o">=</span><span class="n">train_image_paths</span><span class="p">,</span>
            <span class="n">label_paths</span><span class="o">=</span><span class="n">train_label_paths</span><span class="p">,</span>
            <span class="n">mask_paths</span><span class="o">=</span><span class="n">train_mask_paths</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">val_data_dicts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">val_image_paths</span><span class="p">:</span>
            <span class="n">val_data_dicts</span> <span class="o">=</span> <span class="n">create_data_dicts_from_paths</span><span class="p">(</span>
                <span class="n">image_paths</span><span class="o">=</span><span class="n">val_image_paths</span><span class="p">,</span>
                <span class="n">label_paths</span><span class="o">=</span><span class="n">val_label_paths</span><span class="p">,</span>
                <span class="n">mask_paths</span><span class="o">=</span><span class="n">val_mask_paths</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">test_data_dicts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">test_image_paths</span><span class="p">:</span>
            <span class="n">test_data_dicts</span> <span class="o">=</span> <span class="n">create_data_dicts_from_paths</span><span class="p">(</span>
                <span class="n">image_paths</span><span class="o">=</span><span class="n">test_image_paths</span><span class="p">,</span>
                <span class="n">label_paths</span><span class="o">=</span><span class="n">test_label_paths</span><span class="p">,</span>
                <span class="n">mask_paths</span><span class="o">=</span><span class="n">test_mask_paths</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Add sample size to dataset kwargs</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;sample_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_size</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">train_data_dicts</span><span class="o">=</span><span class="n">train_data_dicts</span><span class="p">,</span>
            <span class="n">val_data_dicts</span><span class="o">=</span><span class="n">val_data_dicts</span><span class="p">,</span>
            <span class="n">test_data_dicts</span><span class="o">=</span><span class="n">test_data_dicts</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data_dicts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Compose</span><span class="p">],</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">MonaiVolumeDataset</span><span class="p">,</span> <span class="n">MonaiCachedVolumeDataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create volume-specific dataset.&quot;&quot;&quot;</span>

        <span class="c1"># Extract paths from data dictionaries</span>
        <span class="n">image_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_dicts</span><span class="p">]</span>
        <span class="n">label_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_dicts</span> <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>
        <span class="n">mask_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_dicts</span> <span class="k">if</span> <span class="s2">&quot;mask&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>

        <span class="c1"># Ensure we have label and mask paths or None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">label_paths</span><span class="p">:</span>
            <span class="n">label_paths</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_paths</span><span class="p">:</span>
            <span class="n">mask_paths</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">create_volume_dataset</span><span class="p">(</span>
            <span class="n">image_paths</span><span class="o">=</span><span class="n">image_paths</span><span class="p">,</span>
            <span class="n">label_paths</span><span class="o">=</span><span class="n">label_paths</span><span class="p">,</span>
            <span class="n">mask_paths</span><span class="o">=</span><span class="n">mask_paths</span><span class="p">,</span>
            <span class="n">transforms</span><span class="o">=</span><span class="n">transforms</span><span class="p">,</span>
            <span class="n">dataset_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span>
            <span class="n">cache_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_rate</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_kwargs</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TileDataModule</span><span class="p">(</span><span class="n">ConnectomicsDataModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lightning DataModule specifically for tile-based connectomics datasets.</span>

<span class="sd">    This DataModule provides tile-specific functionality for large-scale</span>
<span class="sd">    connectomics datasets stored as individual tiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_volume_json (str): Training volume JSON metadata file</span>
<span class="sd">        train_label_json (str, optional): Training label JSON metadata file</span>
<span class="sd">        train_mask_json (str, optional): Training mask JSON metadata file</span>
<span class="sd">        val_volume_json (str, optional): Validation volume JSON metadata file</span>
<span class="sd">        val_label_json (str, optional): Validation label JSON metadata file</span>
<span class="sd">        val_mask_json (str, optional): Validation mask JSON metadata file</span>
<span class="sd">        test_volume_json (str, optional): Test volume JSON metadata file</span>
<span class="sd">        test_label_json (str, optional): Test label JSON metadata file</span>
<span class="sd">        test_mask_json (str, optional): Test mask JSON metadata file</span>
<span class="sd">        chunk_num (Tuple[int, int, int]): Volume splitting parameters (z, y, x)</span>
<span class="sd">        **kwargs: Additional arguments passed to ConnectomicsDataModule</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">train_volume_json</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">train_label_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">train_mask_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_volume_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_label_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">val_mask_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_volume_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_label_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_mask_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunk_num</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Store tile-specific parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_jsons</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">train_volume_json</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">train_label_json</span><span class="p">,</span>
            <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">train_mask_json</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">val_jsons</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">val_volume_json</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val_jsons</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">val_volume_json</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">val_label_json</span><span class="p">,</span>
                <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">val_mask_json</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">test_jsons</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">test_volume_json</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_jsons</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">test_volume_json</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">test_label_json</span><span class="p">,</span>
                <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">test_mask_json</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="c1"># Add chunk_num to dataset kwargs</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;chunk_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk_num</span>

        <span class="c1"># Create dummy data dictionaries (actual data will be created in _create_dataset)</span>
        <span class="n">train_data_dicts</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;dummy&quot;</span><span class="p">:</span> <span class="s2">&quot;train&quot;</span><span class="p">}]</span>
        <span class="n">val_data_dicts</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;dummy&quot;</span><span class="p">:</span> <span class="s2">&quot;val&quot;</span><span class="p">}]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_jsons</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">test_data_dicts</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;dummy&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">}]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_jsons</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">train_data_dicts</span><span class="o">=</span><span class="n">train_data_dicts</span><span class="p">,</span>
            <span class="n">val_data_dicts</span><span class="o">=</span><span class="n">val_data_dicts</span><span class="p">,</span>
            <span class="n">test_data_dicts</span><span class="o">=</span><span class="n">test_data_dicts</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data_dicts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Compose</span><span class="p">],</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">MonaiTileDataset</span><span class="p">,</span> <span class="n">MonaiCachedTileDataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create tile-specific dataset.&quot;&quot;&quot;</span>

        <span class="c1"># Get appropriate JSON files for the mode</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
            <span class="n">jsons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_jsons</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span>
            <span class="n">jsons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_jsons</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span>
            <span class="n">jsons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_jsons</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">jsons</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">create_tile_dataset</span><span class="p">(</span>
            <span class="n">volume_json</span><span class="o">=</span><span class="n">jsons</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span>
            <span class="n">label_json</span><span class="o">=</span><span class="n">jsons</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
            <span class="n">mask_json</span><span class="o">=</span><span class="n">jsons</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">],</span>
            <span class="n">transforms</span><span class="o">=</span><span class="n">transforms</span><span class="p">,</span>
            <span class="n">dataset_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span>
            <span class="n">cache_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_rate</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_kwargs</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_volume_datamodule</span><span class="p">(</span>
    <span class="n">train_image_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">train_label_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">train_mask_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">val_image_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">val_label_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">val_mask_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sample_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span><span class="p">,</span>
    <span class="n">task_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VolumeDataModule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factory function to create volume-based DataModule with default transforms.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_image_paths: Training image file paths</span>
<span class="sd">        train_label_paths: Optional training label file paths</span>
<span class="sd">        train_mask_paths: Optional training mask file paths</span>
<span class="sd">        val_image_paths: Optional validation image file paths</span>
<span class="sd">        val_label_paths: Optional validation label file paths</span>
<span class="sd">        val_mask_paths: Optional validation mask file paths</span>
<span class="sd">        sample_size: Size of samples to extract (z, y, x)</span>
<span class="sd">        batch_size: Batch size for data loaders</span>
<span class="sd">        num_workers: Number of workers for data loading</span>
<span class="sd">        dataset_type: Type of dataset (&#39;standard&#39;, &#39;cached&#39;, &#39;persistent&#39;)</span>
<span class="sd">        task_type: Type of segmentation task (&#39;binary&#39;, &#39;affinity&#39;, &#39;instance&#39;)</span>
<span class="sd">        **kwargs: Additional arguments for DataModule</span>

<span class="sd">    Returns:</span>
<span class="sd">        Configured VolumeDataModule instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create default transforms based on task type</span>
    <span class="n">transforms</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">train_label_paths</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleNamespace</span>

        <span class="k">if</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">&quot;binary&quot;</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span>
                <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                <span class="n">targets</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;binary&quot;</span><span class="p">}],</span>
            <span class="p">)</span>
            <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_label_transform_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">&quot;affinity&quot;</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span>
                <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                <span class="n">targets</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;affinity&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;offsets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1-0-0&quot;</span><span class="p">,</span> <span class="s2">&quot;0-1-0&quot;</span><span class="p">,</span> <span class="s2">&quot;0-0-1&quot;</span><span class="p">]},</span>
                    <span class="p">}</span>
                <span class="p">],</span>
            <span class="p">)</span>
            <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_label_transform_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span>
                <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                <span class="n">targets</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;binary&quot;</span><span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;instance_boundary&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thickness&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;edge_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;seg-all&quot;</span><span class="p">},</span>
                    <span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;instance_edt&quot;</span><span class="p">,</span> <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="s2">&quot;quantize&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}},</span>
                <span class="p">],</span>
            <span class="p">)</span>
            <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_label_transform_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="c1"># Use same transforms for validation if available</span>
    <span class="k">if</span> <span class="n">val_image_paths</span> <span class="ow">and</span> <span class="n">transforms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">):</span>
        <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">VolumeDataModule</span><span class="p">(</span>
        <span class="n">train_image_paths</span><span class="o">=</span><span class="n">train_image_paths</span><span class="p">,</span>
        <span class="n">train_label_paths</span><span class="o">=</span><span class="n">train_label_paths</span><span class="p">,</span>
        <span class="n">train_mask_paths</span><span class="o">=</span><span class="n">train_mask_paths</span><span class="p">,</span>
        <span class="n">val_image_paths</span><span class="o">=</span><span class="n">val_image_paths</span><span class="p">,</span>
        <span class="n">val_label_paths</span><span class="o">=</span><span class="n">val_label_paths</span><span class="p">,</span>
        <span class="n">val_mask_paths</span><span class="o">=</span><span class="n">val_mask_paths</span><span class="p">,</span>
        <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
        <span class="n">dataset_type</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">,</span>
        <span class="n">transforms</span><span class="o">=</span><span class="n">transforms</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_tile_datamodule</span><span class="p">(</span>
    <span class="n">train_volume_json</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">train_label_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">train_mask_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">val_volume_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">val_label_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">val_mask_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunk_num</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span><span class="p">,</span>
    <span class="n">task_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TileDataModule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factory function to create tile-based DataModule with default transforms.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_volume_json: Training volume JSON metadata file</span>
<span class="sd">        train_label_json: Optional training label JSON metadata file</span>
<span class="sd">        val_volume_json: Optional validation volume JSON metadata file</span>
<span class="sd">        val_label_json: Optional validation label JSON metadata file</span>
<span class="sd">        chunk_num: Volume splitting parameters (z, y, x)</span>
<span class="sd">        batch_size: Batch size for data loaders</span>
<span class="sd">        num_workers: Number of workers for data loading</span>
<span class="sd">        dataset_type: Type of dataset (&#39;standard&#39;, &#39;cached&#39;, &#39;persistent&#39;)</span>
<span class="sd">        task_type: Type of segmentation task (&#39;binary&#39;, &#39;affinity&#39;, &#39;instance&#39;)</span>
<span class="sd">        **kwargs: Additional arguments for DataModule</span>

<span class="sd">    Returns:</span>
<span class="sd">        Configured TileDataModule instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create default transforms based on task type</span>
    <span class="n">transforms</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">train_label_json</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleNamespace</span>

        <span class="k">if</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">&quot;binary&quot;</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span>
                <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                <span class="n">targets</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;binary&quot;</span><span class="p">}],</span>
            <span class="p">)</span>
            <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_label_transform_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">&quot;affinity&quot;</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span>
                <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                <span class="n">targets</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;affinity&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;offsets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1-0-0&quot;</span><span class="p">,</span> <span class="s2">&quot;0-1-0&quot;</span><span class="p">,</span> <span class="s2">&quot;0-0-1&quot;</span><span class="p">]},</span>
                    <span class="p">}</span>
                <span class="p">],</span>
            <span class="p">)</span>
            <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_label_transform_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span>
                <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                <span class="n">targets</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;binary&quot;</span><span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;instance_boundary&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;thickness&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;edge_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;seg-all&quot;</span><span class="p">},</span>
                    <span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;instance_edt&quot;</span><span class="p">,</span> <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="s2">&quot;quantize&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}},</span>
                <span class="p">],</span>
            <span class="p">)</span>
            <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_label_transform_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="c1"># Use same transforms for validation if available</span>
    <span class="k">if</span> <span class="n">val_volume_json</span> <span class="ow">and</span> <span class="n">transforms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">):</span>
        <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">TileDataModule</span><span class="p">(</span>
        <span class="n">train_volume_json</span><span class="o">=</span><span class="n">train_volume_json</span><span class="p">,</span>
        <span class="n">train_label_json</span><span class="o">=</span><span class="n">train_label_json</span><span class="p">,</span>
        <span class="n">train_mask_json</span><span class="o">=</span><span class="n">train_mask_json</span><span class="p">,</span>
        <span class="n">val_volume_json</span><span class="o">=</span><span class="n">val_volume_json</span><span class="p">,</span>
        <span class="n">val_label_json</span><span class="o">=</span><span class="n">val_label_json</span><span class="p">,</span>
        <span class="n">val_mask_json</span><span class="o">=</span><span class="n">val_mask_json</span><span class="p">,</span>
        <span class="n">chunk_num</span><span class="o">=</span><span class="n">chunk_num</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
        <span class="n">dataset_type</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">,</span>
        <span class="n">transforms</span><span class="o">=</span><span class="n">transforms</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_datamodule_from_config</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">VolumeDataModule</span><span class="p">,</span> <span class="n">TileDataModule</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create DataModule from configuration dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Configuration dictionary with dataset parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Appropriate DataModule instance based on configuration</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dataset_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DATASET&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="c1"># Determine dataset type</span>
    <span class="k">if</span> <span class="s2">&quot;volume_json&quot;</span> <span class="ow">in</span> <span class="n">dataset_config</span> <span class="ow">or</span> <span class="s2">&quot;train_volume_json&quot;</span> <span class="ow">in</span> <span class="n">dataset_config</span><span class="p">:</span>
        <span class="c1"># Tile-based dataset</span>
        <span class="k">return</span> <span class="n">TileDataModule</span><span class="p">(</span>
            <span class="n">train_volume_json</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_volume_json&quot;</span><span class="p">),</span>
            <span class="n">train_label_json</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_label_json&quot;</span><span class="p">),</span>
            <span class="n">train_mask_json</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_mask_json&quot;</span><span class="p">),</span>
            <span class="n">val_volume_json</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;val_volume_json&quot;</span><span class="p">),</span>
            <span class="n">val_label_json</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;val_label_json&quot;</span><span class="p">),</span>
            <span class="n">val_mask_json</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;val_mask_json&quot;</span><span class="p">),</span>
            <span class="n">chunk_num</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_num&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SOLVER&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_workers&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">dataset_type</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataset_type&quot;</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Volume-based dataset</span>
        <span class="k">return</span> <span class="n">VolumeDataModule</span><span class="p">(</span>
            <span class="n">train_image_paths</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_image_paths&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="n">train_label_paths</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_label_paths&quot;</span><span class="p">),</span>
            <span class="n">train_mask_paths</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_mask_paths&quot;</span><span class="p">),</span>
            <span class="n">val_image_paths</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;val_image_paths&quot;</span><span class="p">),</span>
            <span class="n">val_label_paths</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;val_label_paths&quot;</span><span class="p">),</span>
            <span class="n">val_mask_paths</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;val_mask_paths&quot;</span><span class="p">),</span>
            <span class="n">sample_size</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample_size&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)),</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SOLVER&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_workers&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">dataset_type</span><span class="o">=</span><span class="n">dataset_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataset_type&quot;</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">),</span>
        <span class="p">)</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ConnectomicsDataModule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;VolumeDataModule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TileDataModule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_volume_datamodule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_tile_datamodule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_datamodule_from_config&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

              </article>
              
            </div>
            <footer>
  

  

  <hr>

  

  <div role="contentinfo">
    <p>
      &copy; Copyright 2019-2026, PyTorch Connectomics Contributors.

    </p>
  </div>
  
  <div style="margin-bottom:1cm">
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a
      href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the
      Docs</a>.
  </div>
   

</footer>
          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
    </section>
  </div>

  

  
  <script type="text/javascript" id="documentation_options" data-url_root="../../../../"
    src="../../../../_static/documentation_options.js"></script>
  <script src="../../../../_static/documentation_options.js?v=f4332903"></script>
  <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
  <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
  

  

  <script type="text/javascript" src="../../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <!-- <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Visual Computing Group</h2>
          <p>Visual computing group (VCG) led by Prof. Hanspeter Pfister at Harvard University</p>
          <a class="with-right-arrow" href="https://vcg.seas.harvard.edu/">View VCG</a>
        </div>
        <div class="col-md-4 text-center">
          <h2>Lichtman Lab</h2>
          <p>Neuroscience research lab led by Prof. Jeff Lichtman at Harvard University</p>
          <a class="with-right-arrow" href="https://lichtmanlab.fas.harvard.edu">View Lichtman Lab</a>
        </div>
        <div class="col-md-4 text-center">
          <h2>PyTorch</h2>
          <p>An open source machine learning framework</p>
          <a class="with-right-arrow" href="https://pytorch.org/">View PyTorch</a>
        </div>
      </div>
    </div> -->
  </div>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->
  <!--
  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://zudi-lin.github.io/pytorch_connectomics/build/html/index.html" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>
    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="#">Get Started</a>
          </li>
          <li>
            <a href="#">Features</a>
          </li>
          <li>
            <a href="#">Ecosystem</a>
          </li>
          <li>
            <a href="">Blog</a>
          </li>
          <li>
            <a href="https://zudi-lin.github.io/pytorch_connectomics/build/html/tutorials/snemi.html">Tutorials</a>
          </li>
          <li>
            <a href="https://zudi-lin.github.io/pytorch_connectomics/build/html/index.html">Docs</a>
          </li>
          <li>
            <a href="">Resources</a>
          </li>
          <li>
            <a href="https://github.com/zudi-lin/pytorch_connectomics/tree/master">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  -->
  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    var collapsedSections = ['Notes']
    $(document).ready(function () {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function (e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>

  <!-- at the end of the BODY -->
  <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
  <script>
    /* global docsearch */
    docsearch({
      container: "#docsearch",
      apiKey: "f072ddc06d4d2d86f6b26fb6f12a4699",
      indexName: "readthedocs",
      placeholder: "Search PyTorch Connectomics",
    });
  </script>

</body>

</html>