



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>connectomics.metrics.metrics_skel &mdash; connectomics latest documentation</title>
  

  
  
  
  

  

  
  
  

  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../_static/css/pytc-theme.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/readthedocs-doc-embed.css" type="text/css" />
  <link rel="index" title="Index" href="../../../genindex.html" />
  <link rel="search" title="Search" href="../../../search.html" /> 

    <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="text.css" type="text/css" />

  <!-- at the end of the HEAD -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">

    <a class="header-logo" href="../../../index.html" aria-label="PyTC"></a>

    <div class="header-container">

      <div class="main-menu">
        <ul>
          <li>
            <a href="../../../notes/installation.html">Get Started</a>
          </li>
          <li>
            <a href="../../../tutorials/neuron.html">Tutorials</a>
          </li>
          <li>
            <a href="../../../index.html">Docs</a>
          </li>
          <li>
            <a href="https://github.com/zudi-lin/pytorch_connectomics/tree/master">GitHub</a>
          </li>
          <li>
            <a href="../../../about/team.html">About Us</a>
          </li>

        </ul>
      </div>

      <!-- <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a> -->
    </div>

  </div>
</div>


<body class="pytorch-body">

   

  

  <div class="table-of-contents-link-wrapper">
    <span>Table of Contents</span>
    <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
  </div>

  <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
    <div class="pytorch-side-scroll">
      <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <div class="pytorch-left-menu-search">
          

          
          
          
          <div class="version">
            latest
          </div>
          
          

          <div id="docsearch"></div>

          
        </div>

        
        
        
        
        
        
        <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/config.html">Configuration System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/dataloading.html">Data Loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/migration.html">Migration Guide (v1.0 â†’ v2.0)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/neuron.html">Neuron Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/mito.html">Mitochondria Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/synapse.html">Synapse Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/artifact.html">Artifacts Detection (Draft)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../external/neuroglancer.html">Neuroglancer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/lightning.html">Lightning Module API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/model.html">connectomics.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/data.html">connectomics.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/utils.html">connectomics.utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/team.html">About Us</a></li>
</ul>

        
        
      </div>
    </div>

    


    

    <!-- 
    
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
      <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Read the Docs</span>
        v: latest
        <span class="fa fa-caret-down"></span>
      </span>
      <div class="rst-other-versions">
        <dl>
          <dt>Versions</dt>
          
          <dd><a href="#">latest</a></dd>
          
        </dl>
        <dl>
          <dt>Downloads</dt>
          <dd><a href="https://github.com/zudi-lin/pytorch_connectomics/">PDF</a>
          </dd>
          <dd><a href="https://github.com/zudi-lin/pytorch_connectomics/">HTML</a></dd>
        </dl>
        <dl>
          <dt>On Github</dt>
          <dd><a href="https://github.com/zudi-lin/pytorch_connectomics">Home</a></dd>
          <dd><a href="https://github.com/zudi-lin/pytorch_connectomics/">Docs</a></dd>
        </dl>
      </div>
    </div>
    
     -->

  </nav>


  <div class="pytorch-container">
    <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
      <div class="pytorch-breadcrumbs-wrapper">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../index.html">Module code</a> &gt;</li>
        
      <li>connectomics.metrics.metrics_skel</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
      </div>

      <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
        Shortcuts
      </div>
    </div>

    <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
      <div class="pytorch-content-left">

        
        
          <div class="rst-content">
            
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
              <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
                
  <h1>Source code for connectomics.metrics.metrics_skel</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Skeleton-based evaluation metrics for curvilinear structures.</span>

<span class="sd">This module provides metrics for evaluating segmentation quality of curvilinear</span>
<span class="sd">structures (e.g., neurons, blood vessels) based on skeleton correctness,</span>
<span class="sd">completeness, and quality.</span>

<span class="sd">Based on:</span>
<span class="sd">    Mosinska et al., &quot;Beyond the Pixel-Wise Loss for Topology-Aware Delineation&quot;</span>
<span class="sd">    https://arxiv.org/abs/1712.02190</span>

<span class="sd">Metrics:</span>
<span class="sd">    - Correctness: TP / (TP + FP) on skeleton</span>
<span class="sd">    - Completeness: TP / (TP + FN) on skeleton</span>
<span class="sd">    - Quality: (Completeness * Correctness) /</span>
<span class="sd">      (Completeness + Correctness - Completeness * Correctness)</span>
<span class="sd">    - Foreground IoU: Intersection over Union of foreground regions</span>

<span class="sd">Supports multi-CPU parallelism with Python multiprocessing for batch evaluation.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">imageio</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">imageio</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">skimage.morphology</span><span class="w"> </span><span class="kn">import</span> <span class="n">skeletonize</span><span class="p">,</span> <span class="n">dilation</span><span class="p">,</span> <span class="n">square</span>


<div class="viewcode-block" id="compute_skeleton_metrics">
<a class="viewcode-back" href="../../../modules/metrics.html#connectomics.metrics.compute_skeleton_metrics">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_skeleton_metrics</span><span class="p">(</span>
    <span class="n">skeleton_output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">skeleton_gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">skeleton_output_dil</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">skeleton_gt_dil</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute skeleton-based metrics for curvilinear structure evaluation.</span>

<span class="sd">    Args:</span>
<span class="sd">        skeleton_output: List of skeletonized predictions (binarized)</span>
<span class="sd">        skeleton_gt: List of skeletonized ground truth</span>
<span class="sd">        skeleton_output_dil: List of dilated skeletonized predictions</span>
<span class="sd">        skeleton_gt_dil: List of dilated skeletonized ground truth</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (correctness, completeness, quality) metrics</span>
<span class="sd">            - Correctness: True positives / (True positives + False positives)</span>
<span class="sd">            - Completeness: True positives / (True positives + False negatives)</span>
<span class="sd">            - Quality: F-measure combining correctness and completeness</span>

<span class="sd">    Notes:</span>
<span class="sd">        - All inputs should be binary arrays (0 or 1)</span>
<span class="sd">        - Dilation factor should be consistent (typically 5x5 square)</span>
<span class="sd">        - Quality is 0 if denominator is 0 (no predictions or ground truth)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tpcor</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># True positives for correctness</span>
    <span class="n">tpcom</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># True positives for completeness</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># False negatives</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># False positives</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">skeleton_output</span><span class="p">)):</span>
        <span class="c1"># Correctness: predicted skeleton matches dilated GT</span>
        <span class="n">tpcor</span> <span class="o">+=</span> <span class="p">((</span><span class="n">skeleton_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">skeleton_gt_dil</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">skeleton_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Completeness: GT skeleton matches dilated prediction</span>
        <span class="n">tpcom</span> <span class="o">+=</span> <span class="p">((</span><span class="n">skeleton_gt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">skeleton_output_dil</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">skeleton_gt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># False negatives: GT not covered by dilated prediction</span>
        <span class="n">fn</span> <span class="o">+=</span> <span class="p">(</span><span class="n">skeleton_gt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">skeleton_gt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">skeleton_output_dil</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">skeleton_gt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># False positives: prediction not matching dilated GT</span>
        <span class="n">fp</span> <span class="o">+=</span> <span class="p">(</span><span class="n">skeleton_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">skeleton_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">skeleton_gt_dil</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">skeleton_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Calculate metrics with safety checks</span>
    <span class="n">correctness</span> <span class="o">=</span> <span class="n">tpcor</span> <span class="o">/</span> <span class="p">(</span><span class="n">tpcor</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tpcor</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">completeness</span> <span class="o">=</span> <span class="n">tpcom</span> <span class="o">/</span> <span class="p">(</span><span class="n">tpcom</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tpcom</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="c1"># Quality (F-measure)</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">completeness</span> <span class="o">+</span> <span class="n">correctness</span> <span class="o">-</span> <span class="n">completeness</span> <span class="o">*</span> <span class="n">correctness</span>
    <span class="n">quality</span> <span class="o">=</span> <span class="p">(</span><span class="n">completeness</span> <span class="o">*</span> <span class="n">correctness</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">)</span> <span class="k">if</span> <span class="n">denominator</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">correctness</span><span class="p">,</span> <span class="n">completeness</span><span class="p">,</span> <span class="n">quality</span></div>



<div class="viewcode-block" id="compute_precision_recall">
<a class="viewcode-back" href="../../../modules/metrics.html#connectomics.metrics.compute_precision_recall">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_precision_recall</span><span class="p">(</span>
    <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">gt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">dilation_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute precision and recall metrics for single prediction-GT pair.</span>

<span class="sd">    Args:</span>
<span class="sd">        pred: Predicted binary segmentation mask</span>
<span class="sd">        gt: Ground truth binary segmentation mask</span>
<span class="sd">        dilation_size: Size of square structuring element for dilation. Default: 5</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (correctness, completeness, quality) metrics</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Automatically skeletonizes input masks</span>
<span class="sd">        - Applies dilation with specified size (default 5x5 square)</span>
<span class="sd">        - Returns 0.0 for all metrics if inputs are empty</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Skeletonize both prediction and ground truth</span>
    <span class="n">pred_skel</span> <span class="o">=</span> <span class="n">skeletonize</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">gt_skel</span> <span class="o">=</span> <span class="n">skeletonize</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>

    <span class="c1"># Dilate skeletons for tolerance in matching</span>
    <span class="n">pred_dil</span> <span class="o">=</span> <span class="n">dilation</span><span class="p">(</span><span class="n">pred_skel</span><span class="p">,</span> <span class="n">square</span><span class="p">(</span><span class="n">dilation_size</span><span class="p">))</span>
    <span class="n">gt_dil</span> <span class="o">=</span> <span class="n">dilation</span><span class="p">(</span><span class="n">gt_skel</span><span class="p">,</span> <span class="n">square</span><span class="p">(</span><span class="n">dilation_size</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">compute_skeleton_metrics</span><span class="p">([</span><span class="n">pred_skel</span><span class="p">],</span> <span class="p">[</span><span class="n">gt_skel</span><span class="p">],</span> <span class="p">[</span><span class="n">pred_dil</span><span class="p">],</span> <span class="p">[</span><span class="n">gt_dil</span><span class="p">])</span></div>



<div class="viewcode-block" id="compute_iou">
<a class="viewcode-back" href="../../../modules/metrics.html#connectomics.metrics.compute_iou">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_iou</span><span class="p">(</span><span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">gt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate foreground Intersection over Union (IoU).</span>

<span class="sd">    Args:</span>
<span class="sd">        pred: Predicted binary mask</span>
<span class="sd">        gt: Ground truth binary mask</span>

<span class="sd">    Returns:</span>
<span class="sd">        Foreground IoU score in range [0.0, 1.0]</span>
<span class="sd">            - 1.0: Perfect overlap</span>
<span class="sd">            - 0.0: No overlap or empty union</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Both inputs should be binary (0 or 1)</span>
<span class="sd">        - Returns 0.0 if union is empty (both masks are empty)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">gt</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">union</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">gt</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">union</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">inter</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">union</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>



<div class="viewcode-block" id="binarize_masks">
<a class="viewcode-back" href="../../../modules/metrics.html#connectomics.metrics.binarize_masks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">binarize_masks</span><span class="p">(</span>
    <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">gt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Binarize prediction and ground truth masks.</span>

<span class="sd">    Args:</span>
<span class="sd">        pred: Prediction mask (0-255 range)</span>
<span class="sd">        gt: Ground truth mask (0-255 range)</span>
<span class="sd">        threshold: Threshold for binarizing prediction. Default: 128</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (binarized_pred, binarized_gt) as uint8 arrays</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Prediction: threshold at specified value (default 128)</span>
<span class="sd">        - Ground truth: exclude 0 (background) and 255 (ignore) pixels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pred_bin</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">gt_bin</span> <span class="o">=</span> <span class="p">((</span><span class="n">gt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gt</span> <span class="o">!=</span> <span class="mi">255</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pred_bin</span><span class="p">,</span> <span class="n">gt_bin</span></div>



<div class="viewcode-block" id="evaluate_image_pair">
<a class="viewcode-back" href="../../../modules/metrics.html#connectomics.metrics.evaluate_image_pair">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_image_pair</span><span class="p">(</span>
    <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">gt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
    <span class="n">dilation_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate single prediction-ground truth pair.</span>

<span class="sd">    Args:</span>
<span class="sd">        pred: Prediction mask (0-255 range)</span>
<span class="sd">        gt: Ground truth mask (0-255 range)</span>
<span class="sd">        threshold: Threshold for binarizing prediction. Default: 128</span>
<span class="sd">        dilation_size: Dilation size for skeleton matching. Default: 5</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (iou, correctness, completeness, quality) metrics</span>
<span class="sd">            - Returns (1.0, 1.0, 1.0, 1.0) if GT is empty</span>
<span class="sd">            - All values in range [0.0, 1.0]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Binarize masks</span>
    <span class="n">pred_bin</span><span class="p">,</span> <span class="n">gt_bin</span> <span class="o">=</span> <span class="n">binarize_masks</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

    <span class="c1"># Handle empty ground truth</span>
    <span class="n">num_gt</span> <span class="o">=</span> <span class="n">gt_bin</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">num_gt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span>

    <span class="c1"># Compute metrics</span>
    <span class="n">iou</span> <span class="o">=</span> <span class="n">compute_iou</span><span class="p">(</span><span class="n">pred_bin</span><span class="p">,</span> <span class="n">gt_bin</span><span class="p">)</span>
    <span class="n">correctness</span><span class="p">,</span> <span class="n">completeness</span><span class="p">,</span> <span class="n">quality</span> <span class="o">=</span> <span class="n">compute_precision_recall</span><span class="p">(</span><span class="n">pred_bin</span><span class="p">,</span> <span class="n">gt_bin</span><span class="p">,</span> <span class="n">dilation_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">iou</span><span class="p">,</span> <span class="n">correctness</span><span class="p">,</span> <span class="n">completeness</span><span class="p">,</span> <span class="n">quality</span></div>



<span class="c1"># ============================================================================</span>
<span class="c1"># Batch Evaluation Functions (for standalone script usage)</span>
<span class="c1"># ============================================================================</span>


<div class="viewcode-block" id="evaluate_file_pair">
<a class="viewcode-back" href="../../../modules/metrics.html#connectomics.metrics.evaluate_file_pair">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_file_pair</span><span class="p">(</span>
    <span class="n">pred_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">gt_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
    <span class="n">dilation_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate single file pair (for parallel processing).</span>

<span class="sd">    Args:</span>
<span class="sd">        pred_path: Path to prediction image</span>
<span class="sd">        gt_path: Path to ground truth image</span>
<span class="sd">        threshold: Threshold for binarizing prediction. Default: 128</span>
<span class="sd">        dilation_size: Dilation size for skeleton matching. Default: 5</span>
<span class="sd">        verbose: Print results for each image. Default: False</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (iou, correctness, completeness, quality) or empty list if file missing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">imageio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;imageio is required for loading images. Install with: pip install imageio&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pred_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Load images</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">pred_path</span><span class="p">)</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">gt_path</span><span class="p">)</span>

    <span class="c1"># Evaluate</span>
    <span class="n">iou</span><span class="p">,</span> <span class="n">correctness</span><span class="p">,</span> <span class="n">completeness</span><span class="p">,</span> <span class="n">quality</span> <span class="o">=</span> <span class="n">evaluate_image_pair</span><span class="p">(</span>
        <span class="n">pred</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">dilation_size</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">pred_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: IoU=</span><span class="si">{</span><span class="n">iou</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Corr=</span><span class="si">{</span><span class="n">correctness</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Comp=</span><span class="si">{</span><span class="n">completeness</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Qual=</span><span class="si">{</span><span class="n">quality</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">iou</span><span class="p">,</span> <span class="n">correctness</span><span class="p">,</span> <span class="n">completeness</span><span class="p">,</span> <span class="n">quality</span></div>



<div class="viewcode-block" id="evaluate_directory">
<a class="viewcode-back" href="../../../modules/metrics.html#connectomics.metrics.evaluate_directory">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_directory</span><span class="p">(</span>
    <span class="n">pred_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">gt_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pred_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%03d</span><span class="s2">_pred.png&quot;</span><span class="p">,</span>
    <span class="n">gt_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%03d</span><span class="s2">.png&quot;</span><span class="p">,</span>
    <span class="n">max_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
    <span class="n">dilation_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate all images in directories using parallel processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        pred_dir: Directory containing prediction images</span>
<span class="sd">        gt_dir: Directory containing ground truth images</span>
<span class="sd">        pred_pattern: Filename pattern for predictions (with %d for index)</span>
<span class="sd">        gt_pattern: Filename pattern for ground truth (with %d for index)</span>
<span class="sd">        max_index: Maximum image index to evaluate</span>
<span class="sd">        threshold: Threshold for binarizing predictions. Default: 128</span>
<span class="sd">        dilation_size: Dilation size for skeleton matching. Default: 5</span>
<span class="sd">        num_workers: Number of parallel workers (None = all CPUs). Default: None</span>
<span class="sd">        verbose: Print progress and results. Default: True</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with keys:</span>
<span class="sd">            - &#39;mean_iou&#39;: Mean foreground IoU</span>
<span class="sd">            - &#39;mean_correctness&#39;: Mean skeleton correctness</span>
<span class="sd">            - &#39;mean_completeness&#39;: Mean skeleton completeness</span>
<span class="sd">            - &#39;mean_quality&#39;: Mean skeleton quality</span>
<span class="sd">            - &#39;num_evaluated&#39;: Number of images successfully evaluated</span>
<span class="sd">            - &#39;results&#39;: Array of shape (N, 4) with per-image results</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; results = evaluate_directory(</span>
<span class="sd">        ...     pred_dir=&quot;predictions/&quot;,</span>
<span class="sd">        ...     gt_dir=&quot;ground_truth/&quot;,</span>
<span class="sd">        ...     max_index=100</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Mean IoU: {results[&#39;mean_iou&#39;]:.4f}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_workers</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluating with </span><span class="si">{</span><span class="n">num_workers</span><span class="si">}</span><span class="s2"> workers...&quot;</span><span class="p">)</span>

    <span class="c1"># Prepare file pairs</span>
    <span class="n">pred_dir</span> <span class="o">=</span> <span class="n">pred_dir</span> <span class="k">if</span> <span class="n">pred_dir</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">pred_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
    <span class="n">gt_dir</span> <span class="o">=</span> <span class="n">gt_dir</span> <span class="k">if</span> <span class="n">gt_dir</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">gt_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>

    <span class="n">file_pairs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">pred_dir</span> <span class="o">+</span> <span class="p">(</span><span class="n">pred_pattern</span> <span class="o">%</span> <span class="n">i</span><span class="p">),</span> <span class="n">gt_dir</span> <span class="o">+</span> <span class="p">(</span><span class="n">gt_pattern</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_index</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Parallel evaluation</span>
    <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">evaluate_file_pair</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">dilation_size</span><span class="p">,</span> <span class="n">verbose</span><span class="p">),</span> <span class="n">file_pairs</span>
        <span class="p">)</span>

    <span class="c1"># Filter out missing files and compute statistics</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="p">[]]</span>
    <span class="n">results_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: No valid results found!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;mean_iou&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;mean_correctness&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;mean_completeness&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;mean_quality&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;num_evaluated&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results_array</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">mean_metrics</span> <span class="o">=</span> <span class="n">results_array</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mean_iou&quot;</span><span class="p">:</span> <span class="n">mean_metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;mean_correctness&quot;</span><span class="p">:</span> <span class="n">mean_metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;mean_completeness&quot;</span><span class="p">:</span> <span class="n">mean_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;mean_quality&quot;</span><span class="p">:</span> <span class="n">mean_metrics</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;num_evaluated&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results_array</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluated </span><span class="si">{</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;num_evaluated&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> images&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean IoU:          </span><span class="si">{</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;mean_iou&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Correctness:  </span><span class="si">{</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;mean_correctness&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Completeness: </span><span class="si">{</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;mean_completeness&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Quality:      </span><span class="si">{</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span></div>



<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;compute_skeleton_metrics&quot;</span><span class="p">,</span>
    <span class="s2">&quot;compute_precision_recall&quot;</span><span class="p">,</span>
    <span class="s2">&quot;compute_iou&quot;</span><span class="p">,</span>
    <span class="s2">&quot;binarize_masks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;evaluate_image_pair&quot;</span><span class="p">,</span>
    <span class="s2">&quot;evaluate_file_pair&quot;</span><span class="p">,</span>
    <span class="s2">&quot;evaluate_directory&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

              </article>
              
            </div>
            <footer>
  

  

  <hr>

  

  <div role="contentinfo">
    <p>
      &copy; Copyright 2019-2025, PyTorch Connectomics Contributors.

    </p>
  </div>
  
  <div style="margin-bottom:1cm">
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a
      href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the
      Docs</a>.
  </div>
   

</footer>
          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
    </section>
  </div>

  

  
  <script type="text/javascript" id="documentation_options" data-url_root="../../../"
    src="../../../_static/documentation_options.js"></script>
  <script src="../../../_static/documentation_options.js?v=f4332903"></script>
  <script src="../../../_static/doctools.js?v=9bcbadda"></script>
  <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
  

  

  <script type="text/javascript" src="../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <!-- <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Visual Computing Group</h2>
          <p>Visual computing group (VCG) led by Prof. Hanspeter Pfister at Harvard University</p>
          <a class="with-right-arrow" href="https://vcg.seas.harvard.edu/">View VCG</a>
        </div>
        <div class="col-md-4 text-center">
          <h2>Lichtman Lab</h2>
          <p>Neuroscience research lab led by Prof. Jeff Lichtman at Harvard University</p>
          <a class="with-right-arrow" href="https://lichtmanlab.fas.harvard.edu">View Lichtman Lab</a>
        </div>
        <div class="col-md-4 text-center">
          <h2>PyTorch</h2>
          <p>An open source machine learning framework</p>
          <a class="with-right-arrow" href="https://pytorch.org/">View PyTorch</a>
        </div>
      </div>
    </div> -->
  </div>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->
  <!--
  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://zudi-lin.github.io/pytorch_connectomics/build/html/index.html" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>
    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="#">Get Started</a>
          </li>
          <li>
            <a href="#">Features</a>
          </li>
          <li>
            <a href="#">Ecosystem</a>
          </li>
          <li>
            <a href="">Blog</a>
          </li>
          <li>
            <a href="https://zudi-lin.github.io/pytorch_connectomics/build/html/tutorials/snemi.html">Tutorials</a>
          </li>
          <li>
            <a href="https://zudi-lin.github.io/pytorch_connectomics/build/html/index.html">Docs</a>
          </li>
          <li>
            <a href="">Resources</a>
          </li>
          <li>
            <a href="https://github.com/zudi-lin/pytorch_connectomics/tree/master">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  -->
  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    var collapsedSections = ['Notes']
    $(document).ready(function () {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function (e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>

  <!-- at the end of the BODY -->
  <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
  <script>
    /* global docsearch */
    docsearch({
      container: "#docsearch",
      apiKey: "f072ddc06d4d2d86f6b26fb6f12a4699",
      indexName: "readthedocs",
      placeholder: "Search PyTorch Connectomics",
    });
  </script>

</body>

</html>